plugins {
    id 'org.hidetake.ssh' version '2.6.0'
}

ssh.settings {
    knownHosts = allowAnyHosts
}

remotes {
    test {
        host = bpHost
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    prod {
        host = bpProdHost
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    demo {
        host = bpDemoHost
        user = bpDemoUser
        password = bpDemoPassword
        port = bpDemoPort as Integer
    }
}

def remoteInstallDir = '/var/www/bitplay-gui'
def remoteHomeDir = '/home/' + bpUser

task clean << {
    delete project.buildDir
}

task deployTest << {
    ssh.run {
        session(remotes.test) {
            put from: "output/*", into: "${remoteHomeDir}/bitplay-gui"
            executeSudo "sudo rm -rf ${remoteInstallDir}/*", pty: true
            executeSudo "sudo cp -r ${remoteHomeDir}/bitplay-gui/* ${remoteInstallDir}", pty: true
        }
    }
}

task deployProd << {
    ssh.run {
        session(remotes.prod) {
            put from: "output/*", into: "${remoteHomeDir}/bitplay-gui"
            executeSudo "sudo rm -rf ${remoteInstallDir}/*", pty: true
            executeSudo "sudo cp -r ${remoteHomeDir}/bitplay-gui/* ${remoteInstallDir}", pty: true
        }
    }
}

task deployDemo << {
    def remoteHomeDir1 = '/home/' + remotes.demo.user

    ssh.run {
        session(remotes.demo) {
            put from: "output/*", into: "$remoteHomeDir1/bitplay-gui"
            executeSudo "sudo rm -rf ${remoteInstallDir}/*", pty: true
            executeSudo "sudo cp -r $remoteHomeDir1/bitplay-gui/* ${remoteInstallDir}", pty: true
        }
    }
}