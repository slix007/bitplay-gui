plugins {
    id 'org.hidetake.ssh' version '2.6.0'
}

ssh.settings {
    knownHosts = allowAnyHosts
}

remotes {
    host658 {
        host = bpHost658
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    host659 {
        host = bpHost659
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    host660 {
        host = bpHost660
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    host662 {
        host = bpHost662
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    host667 {
        host = bpHost667
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    host668 {
        host = bpHost668
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    host669 {
        host = bpHost669
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    host661 {
        host = bpHost661
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    test {
        host = bpHost
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    prod {
        host = bpProdHost
        user = bpUser
        password = bpPassword
        port = bpPort as Integer
    }
    demo {
        host = bpDemoHost
        user = bpUser
        password = bpDemoPassword
        port = bpDemoPort as Integer
    }
}

def remoteInstallDir = '/var/www/bitplay-gui'
def remoteHomeDir = '/home/' + bpUser

task clean << { delete project.buildDir }


// Test servers
task deployHost658 << { sshRun(remotes.host658, remoteHomeDir, remoteInstallDir) }
task deployHost660 << { sshRun(remotes.host660, remoteHomeDir, remoteInstallDir) }

// Prod servers
task deployHost659 << { sshRun(remotes.host659, remoteHomeDir, remoteInstallDir) }
task deployHost662 << { sshRun(remotes.host662, remoteHomeDir, remoteInstallDir) }
task deployHost667 << { sshRun(remotes.host667, remoteHomeDir, remoteInstallDir) }
task deployHost668 << { sshRun(remotes.host668, remoteHomeDir, remoteInstallDir) }
task deployHost669 << { sshRun(remotes.host669, remoteHomeDir, remoteInstallDir) }
task deployHost661 << { sshRun(remotes.host661, remoteHomeDir, remoteInstallDir) }
task deployTest << { sshRun(remotes.test, remoteHomeDir, remoteInstallDir) }
task deployProd << { sshRun(remotes.prod, remoteHomeDir, remoteInstallDir) }
task deployDemo << { sshRun(remotes.demo, remoteHomeDir, remoteInstallDir) }

private void sshRun(hostName, remoteHomeDir, remoteInstallDir) {
    ssh.run {
        session(hostName) {
            println remoteInstallDir
            println remoteHomeDir
            put from: "output", into: "${remoteHomeDir}/bitplay-gui"
            executeSudo "sudo rm -rf ${remoteInstallDir}/*", pty: true
            executeSudo "sudo cp -r ${remoteHomeDir}/bitplay-gui/output/** ${remoteInstallDir}", pty: true
        }
    }
}
